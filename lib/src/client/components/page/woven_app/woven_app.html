<link rel="import" href="../../../../../../../packages/polymer/polymer.html">
<link rel="import" href="../../../../../../../packages/core_elements/core_overlay.html">
<link rel="import" href="../../../../../../../packages/core_elements/core_header_panel.html">
<link rel="import" href="../../../../../../../packages/core_elements/core_drawer_panel.html">
<link rel="import" href="../../../../../../../packages/core_elements/core_menu.html">
<link rel="import" href="../../../../../../../packages/core_elements/core_item.html">
<link rel="import" href="../../../../../../../packages/core_elements/core_toolbar.html">
<link rel="import" href="../../../../../../../packages/core_elements/core_pages.html">
<link rel="import" href="../../../../../../../packages/core_elements/core_overlay.html">
<link rel="import" href="../../../../../../../packages/woven/src/client/components/inbox_list/inbox_list.html">
<link rel="import" href="../../../../../../../packages/woven/src/client/components/add_stuff/add_stuff.html">
<link rel="import" href="../../../../../../../packages/woven/src/client/components/dialog/welcome/welcome.html">
<link rel="import" href="../../../../../../../packages/woven/src/client/components/dialog/sign_in/sign_in.html">
<link rel="import" href="../../../../../../../packages/woven/src/client/components/item_preview/item_preview.html">
<link rel="import" href="../../../../../../../packages/woven/src/client/components/item_activities/item_activities.html">
<link rel="import" href="../../../../../../../packages/woven/src/client/components/my_element/my_element.html">
<link rel="import" href="../../../../../../../packages/woven/src/client/components/people_list/people_list.html">
<link rel="import" href="../../../../../../../packages/woven/src/client/components/community_list/community_list.html">
<link rel="import" href="../../../../../../../packages/paper_elements/paper_toast.html">
<link rel="import" href="../../../../../../../packages/core_elements/core_transition_css.html">
<link rel="import" href="../../../../../../../packages/core_elements/core_animated_pages.html">
<link rel="import" href="../../../../../../../packages/core_elements/src/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="../../../../../../../packages/core_elements/src/core-animated-pages/transitions/cross-fade.html">
<link rel="import" href="../../../../../../../packages/core_elements/social_icons.html">
core-icons/iconsets/<iconset>.html

<polymer-element name="woven-app">
  <template>
    <link rel="stylesheet" href="woven_app.css">
    <core-drawer-panel responsiveWidth="{{responsiveWidth}}">

      <div vertical layout drawer>
        <core-header-panel id="side-panel" navigation flex mode="seamed">
            <core-toolbar id="toolbar-drawer" class="toolbar {{app.community == null ? 'has-logo' : ''}}">
              <span id="sidebar-title" class="{{app.community == null ? 'has-logo' : ''}} flashing-fix" data-page="0" data-url="/" on-tap="{{switchPage}}">
                <template if="{{app.community == null}}">
                  <img src="http://cdn.woven.co/assets/images/woven-logo-small-expanded.png">
                </template>
                <template if="{{app.community != null}}">
                  {{app.community.name}}
                </template>
              </span>
            </core-toolbar>

            <!--<core-toolbar id="toolbar-drawer" class="toolbar {{app.community == null ? has-logo : ''}}">-->
              <!--<span id="community-title" data-page="0" data-url="/" on-tap="{{switchPage}}" >-->
                <!--<img src="http://cdn.woven.co/assets/images/woven-logo-small-expanded.png">-->
              <!--</span>-->
            <!--</core-toolbar>-->

          <core-menu selected="{{app.selectedPage}}" valueattr="data-page" class="menu" theme="core-light-theme">
            <template if="{{app.community != null}}">
              <core-item data-page="0" data-url="/{{app.community.alias}}" label="Everything" icon="list" horizontal center layout class="item" active on-click="{{switchPage}}"></core-item>
              <core-item data-page="2" data-url="/starred" label="Starred" icon="star" horizontal center layout class="item" on-click="{{switchPage}}"></core-item>
              <core-item data-page="3" data-url="/people" label="People" icon="account-circle" horizontal center layout class="item" on-click="{{switchPage}}"></core-item>
            </template>
            <template if="{{app.community == null}}">
              <core-item data-page="0" data-url="/" label="Communities" icon="social:communities" horizontal center layout class="item" active on-click="{{switchPage}}"></core-item>
            </template>

            <div id="button-area">
              <template if="{{app.user == null}}">
                <p id="message"></p>
                <button class="signin-btn" id="facebook-signin" on-click="{{signInWithFacebook}}">Sign in with Facebook</button>
              </template>

              <template if="{{app.user != null}}">
                <p>Hello, {{app.user.username}}!</p>
                <button class="signin-btn" id="facebook-signin" on-click="{{signOut}}">Sign out</button>
              </template>
            </div>

          </core-menu>
        </core-header-panel>

      </div>

      <core-header-panel id="main-panel" main mode="seamed">

        <core-toolbar id="toolbar-main">
          <core-icon-button class="btn primary flashing-fix" id="menu-button" icon="menu" on-tap="{{togglePanel}}"></core-icon-button>
          <span id="page-title" flex></span>
          <template if="{{app.user != null}}">
            <core-icon-button class="btn primary flashing-fix" id="add-button" icon="create" on-tap="{{toggleAddStuff}}"></core-icon-button>
          </template>
          <template if="{{app.user == null}}">
            <core-icon-button class="btn primary flashing-fix" id="add-button" icon="create" on-tap="{{toggleSignIn}}"></core-icon-button>
          </template>
        </core-toolbar>

        <div class="content">
          <core-animated-pages id="pages" transitions="cross-fade slide-from-right" selected="{{app.selectedPage}}">
            <section>
              <template if="{{app.selectedPage === 0 && app.community != null}}">
                <div cross-fade="{{app.selectedPage === 0}}">
                  <inbox-list id="inbox-list" app="{{app}}"></inbox-list>
                </div>
              </template>
              <template if="{{app.community == null}}">
                <div cross-fade="{{app.selectedPage === 0}}">
                  <community-list id="community-list" app="{{app}}"></community-list>
                </div>
              </template>
            </section>
            <section layout vertical>
              <template if="{{app.selectedPage === 1}}">
                <div class="page-wrapper">
                  <item-preview id="item-preview" app="{{app}}"></item-preview>
                  <item-activities app="{{app}}"></item-activities>
                </div>
              </template>
            </section>
            <section layout vertical>
              <template if="{{app.selectedPage === 2}}">
                <div class="page-wrapper">
                  <h1>Starred page is coming soon.</h1>
                </div>
              </template>
            </section>
            <section layout vertical>
              <template if="{{app.selectedPage === 3}}">
                <people-list app="{{app}}"></people-list>
              </template>
            </section>
          </core-animated-pages>
        </div>

      </core-header-panel>

    </core-drawer-panel>
    <template if="{{app.user != null}}">
      <add-stuff app="{{app}}"></add-stuff>
    </template>
    <template if="{{app.user == null}}">
      <!--<sign-in app="{{app}}"></sign-in>-->
      <core-overlay id="sign-in-overlay" class="sign-in-overlay" layered backdrop opened="false" transition="core-transition-center">
        <span id="message">Please sign in to comment.</span>
        <button class="signin-btn" id="facebook-signin" on-click="{{signInWithFacebook}}">Sign in with Facebook</button>
      </core-overlay>
    </template>
    <paper-toast id="toast-message" duration="4000"></paper-toast>
    <template if="{{app.router.route.pattern == '/welcome' && app.user != null}}">
      <welcome-dialog app="{{app}}"></welcome-dialog>
    </template>
  </template>
  <script type="application/dart" src="woven_app.dart"></script>
</polymer-element>
