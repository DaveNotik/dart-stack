<link rel="import" href="../../../../../../packages/polymer/polymer.html">
<link rel="import" href="../../../../../../packages/core_elements/core_field.html">
<link rel="import" href="../../../../../../packages/core_elements/core_input.html">
<link rel="import" href="../../../../../../packages/core_elements/core_icon_button.html">
<link rel="import" href="../../../../../../packages/core_elements/core_a11y_keys.html">
<link rel="import" href="../widgets/live_date_time/live_date_time.html">
<link rel="import" href="../widgets/safe_html/safe_html.html">
<link rel="import" href="../user_picture/user_picture.html">
<polymer-element name="item-activities">
  <template>
    <link rel="stylesheet" href="item_activities.css">
    <div id="post-container">
      <template if="{{app.user != null}}">
        <div layout horizontal>
          <div class="user-area" vertical layout>
            <user-picture app="{{app}}" user="{{app.user.username}}"></user-picture>
          </div>
          <div flex>
            <!--<div class="field-wrapper first transparent">-->
              <!--<strong>{{app.user.username}}</strong>-->
            <!--</div>-->
            <div class="field-wrapper full-height">
              <core-input class="expand" id="comment" multiline rows="1" required placeholder="Your comment..." autocomplete="off"
                          inputValue="{{theData['comment']}}" on-keyup="{{resizeCommentInput}}"
                          on-focus="{{onFocusHandler}}" on-blur="{{onBlurHandler}}" on-tap="{{onFocusHandler}}">
                          </core-input>
            </div>
            <footer>
              <div layout horizontal>
                <div id="comment-message" flex></div>
                <div><core-icon-button id="comment-send-button" class="btn action" icon="send" on-tap="{{addComment}}" tabindex="0"></core-icon-button></div>
              </div>
            </footer>
            <core-a11y-keys id="a11y-send" keys="enter" on-keys-pressed="{{addComment}}"></core-a11y-keys>
          </div>
        </div>
      </template>
      <template if="{{app.user == null}}">
        <div id="signin-container">
          <span id="message">Please sign in to comment.</span>
          <button class="signin-btn" id="facebook-signin" on-click="{{signInWithFacebook}}">Sign in with Facebook</button>
        </div>
      </template>
    </div>

    <div id="activity-wrapper">
      <template if="{{app.selectedItem != null && comments != null}}" repeat="{{comment in comments}}">
        <div layout horizontal>
          <div class="user-area" vertical layout>
            <user-picture app="{{app}}" user="{{comment['user']}}"></user-picture>
          </div>
          <div class="activity-card" flex>
            <div id="content">
              <div class="card-top" horizontal layout>
                <div flex class="user">{{comment['user']}}</div>
                <div class="date-time">
                  <live-date-time value="{{comment['createdDate']}}" formatter="{{formatItemDate}}"></live-date-time>
                </div>
              </div>
              <p><safe-html><template if="{{comment != null}}">{{formatText(comment['comment'])}}</template></safe-html></p>
            </div>
          </div>
        </div>
      </template>
    </div>
  </template>
  <script type="application/dart" src="item_activities.dart"></script>
</polymer-element>
